<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã“ã‚Œã‹ã‚‰ã‚‚ã€ã‚¢ã‚¤ãƒ‰ãƒ«!!!!!!</title>
    <link rel="icon" type="image/svg+xml" href="assets/favicon.svg">
    <link rel="stylesheet" href="css/bg.css">
    <link rel="stylesheet" href="css/all.css">
</head>

<body>
    <div id="js-opening-top" class="opening-top">
        <div class="opening-top__item">
            <picture>
                <source srcset="assets/img/mv_shiny_photo.webp" media="(min-width:750px)">
                <img src="assets/img/mv_shiny_photo_sp.webp" alt="" fetchpriority="high">
            </picture>
        </div>
        <div class="opening-top__item">
            <picture>
                <source srcset="assets/img/mv_milli_photo.webp" media="(min-width:750px)">
                <img src="assets/img/mv_milli_photo_sp.webp" alt="" fetchpriority="high">
            </picture>
        </div>
        <div class="opening-top__item">
            <picture>
                <source srcset="assets/img/mv_765_photo.webp" media="(min-width:750px)">
                <img src="assets/img/mv_765_photo_sp.webp" alt="" fetchpriority="high">
            </picture>
        </div>
        <div class="opening-top__item">
            <picture>
                <source srcset="assets/img/mv_cin_photo.webp" media="(min-width:750px)">
                <img src="assets/img/mv_cin_photo_sp.webp" alt="" fetchpriority="high">
            </picture>
        </div>
        <div class="opening-top__item">
            <picture>
                <source srcset="assets/img/mv_sidem_photo.webp" media="(min-width:750px)">
                <img src="assets/img/mv_sidem_photo_sp.webp" alt="" fetchpriority="high">
            </picture>
        </div>
        <div class="opening-top__item">
            <picture>
                <source srcset="assets/img/mv_gak_photo.webp" media="(min-width:750px)">
                <img src="assets/img/mv_gak_photo_sp.webp" alt="" fetchpriority="high">
            </picture>
        </div>
    </div>
    <img src="assets/img/IM@S_Series_15th_Anniversary_Song_Single_cover.jpg" alt="" id="bg" />
    <div id="bodyContainer">
        <div id="scroll-buttons">
            <button id="go-up" title="å›åˆ°é¡¶éƒ¨" onclick="window.scrollTo({ top: 0, behavior: 'smooth' })">
                <svg xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 384 512"><!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.-->
                    <path fill="#fff"
                        d="M214.6 41.4c-12.5-12.5-32.8-12.5-45.3 0l-160 160c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L160 141.2 160 448c0 17.7 14.3 32 32 32s32-14.3 32-32l0-306.7L329.4 246.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3l-160-160z" />
                </svg><span id="percent"></span>
            </button>
            <button id="go-down" title="ç›´è¾¾åº•éƒ¨"
                onclick="window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' })">
                <svg xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 384 512"><!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.-->
                    <path fill="#fff"
                        d="M169.4 470.6c12.5 12.5 32.8 12.5 45.3 0l160-160c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L224 370.8 224 64c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 306.7L54.6 265.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l160 160z" />
                </svg>
            </button>
        </div>
        <button id="return-button" title="è¿”å›ä¸»é¡µ" onclick="window.location.href='index.html'">
            <svg xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 448 512"><!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.-->
                <path fill="#fff"
                    d="M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.2 288 416 288c17.7 0 32-14.3 32-32s-14.3-32-32-32l-306.7 0L214.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z" />
            </svg>
        </button>
        <h1><button id="title">è§’è‰²ä¸€è§ˆ</button></h1>
        <div id="typing">
            <span id="typing-front"></span><span id="typing-intermark"></span><span id="typing-internal"></span><span
                id="typing-rear"></span><span id="ex-mark"><span id="ex-mark1"></span><span id="ex-mark2"></span><span
                    id="ex-mark3"></span><span id="ex-mark4"></span><span id="ex-mark5"></span><span
                    id="ex-mark6"></span></span><span id="typing-mark"></span>
        </div>
        <div id="filter-container"></div>
        <div id="card-container"></div>
        <div id="modal">
            <div class="dialog">
                <span class="close">Ã—</span>
                <div id="detail-content"></div>
            </div>
        </div>
    </div>
    <script src="js/title.js"></script>
    <script src="./js/scroll.js"></script>
    <script src="js/echarts.min.js"></script>
    <script>
        fetch('data/c@st.min.json').then(r => r.json()).then(data => {
            const container = document.getElementById('card-container');
            const filterContainer = document.getElementById('filter-container');
            const modal = document.getElementById('modal');
            const detail = document.getElementById('detail-content');
            const closeBtn = document.querySelector('.close');

            const now = new Date();
            // å°†å½“å‰æ—¶é—´è½¬æ¢ä¸ºæ—¥æœ¬æ—¶é—´å­—ç¬¦ä¸²
            const jstDate = new Date(now.toLocaleString("en-US", { timeZone: "Asia/Tokyo" }));
            const todayStr = String(jstDate.getMonth() + 1).padStart(2, '0') + String(jstDate.getDate()).padStart(2, '0');

            let similarityTargetRole = null;

            // Flatten staff; merge 961 and 876 productions into Others
            const allRoles = data.flatMap(prod => prod.staff.map(mem => ({
                ...mem,
                production: ['961 Production', '876 Production'].includes(prod.production) ? 'Others' : prod.production
            })));
            // Collect unique productions, exclude Others
            const productions = Array.from(new Set(allRoles.map(r => r.production))).filter(p => p !== 'Others');
            // Buttons order: All, each production, Others, Active
            const buttons = ['ALL', ...productions, 'Others', 'Active'];
            let selected = new Set(['ALL']);
            let activeFilter = true;
            let sortAttr = '';

            const colorMap = {
                'ALL': '#ff74b8', 'THE IDOLM@STER': '#f34f6d', 'CINDERELLA GIRLS': '#2681c8', 'MILLION LIVE!': '#ffc30b',
                'SideM': '#0fbe94', 'SHINY COLORS': '#8dbbff', 'Gakuen': '#f39800', 'Active': '#656a75', 'Others': '#656a75'
            };

            // filter and sort UI
            buttons.forEach(name => {
                const btn = document.createElement('button');
                btn.textContent = name === 'Active' ? 'IDOL' : name;
                btn.dataset.prod = name;
                btn.style.setProperty('--btn-color', colorMap[name] || '#656a75');
                if (name === 'ALL' || name === 'Active') btn.classList.add('active');
                btn.onclick = () => {
                    if (name === 'ALL') selected = new Set(['ALL']);
                    else if (name === 'Active') activeFilter = !activeFilter;
                    else {
                        selected.has(name) ? selected.delete(name) : selected.add(name);
                        if (selected.has('ALL')) selected.delete('ALL');
                        if (selected.size === 0 || (productions.every(p => selected.has(p)) && selected.has('Others'))) selected = new Set(['ALL']);
                    }
                    updateFilters(); updateCards();
                };
                filterContainer.appendChild(btn);
            });
            const sortSelect = document.createElement('select');
            sortSelect.innerHTML = `
            <option value="">é»˜è®¤</option>
            <option value="age">å¹´é¾„</option>
            <option value="height">èº«é«˜</option>
            <option value="weight">ä½“é‡</option>
            <option value="bust">èƒ¸å›´</option>
            <option value="waist">è…°å›´</option>
            <option value="hip">è‡€å›´</option>
            <option value="bmi">BMI</option>
        `;
            sortSelect.onchange = () => {
                sortAttr = sortSelect.value;
                if (sortAttr !== 'similarity') {
                    const simOpt = sortSelect.querySelector('option[value="similarity"]');
                    if (simOpt) {
                        simOpt.remove();
                    }
                    similarityTargetRole = null; // é‡ç½®åŸºå‡†è§’è‰²
                }
                updateCards();
            };
            filterContainer.appendChild(sortSelect);

            function updateFilters() {
                document.querySelectorAll('#filter-container button').forEach(b => {
                    const p = b.dataset.prod;
                    b.classList.toggle('active', p === 'Active' ? activeFilter : selected.has(p));
                });
            }

            function calculateSimilarity(target, current) {
                if (!target || !current) return null;

                let score = 0;
                let percent = 0;
                const fcu = (x, min, diff) => { return (x - min) / diff; }

                if (target.height) {
                    if (!current.height) return null;
                    score += 0.2 * ((fcu(target.height, 127, 48) - fcu(current.height, 127, 48)) ** 2)
                    percent += 0.2;
                }
                if (target.weight) {
                    if (!current.weight) return null;
                    score += 0.15 * ((fcu(target.weight, 28, 32) - fcu(current.weight, 28, 32)) ** 2)
                    percent += 0.15;
                }
                if (Array.isArray(target.three_sizes)) {
                    if (!Array.isArray(current.three_sizes)) return null;
                    if (target.three_sizes[0]) {
                        if (!current.three_sizes[0]) return null;
                        score += 0.3 * ((fcu(target.three_sizes[0], 60, 35) - fcu(current.three_sizes[0], 60, 35)) ** 2)
                        percent += 0.3;
                    }
                    if (target.three_sizes[1]) {
                        if (!current.three_sizes[1]) return null;
                        score += 0.15 * ((fcu(target.three_sizes[1], 47, 18) - fcu(current.three_sizes[1], 47, 18)) ** 2)
                        percent += 0.15;
                    }
                    if (target.three_sizes[2]) {
                        if (!current.three_sizes[2]) return null;
                        score += 0.2 * ((fcu(target.three_sizes[2], 65, 27) - fcu(current.three_sizes[2], 65, 27)) ** 2)
                        percent += 0.2;
                    }
                }
                if (percent === 0) return null;
                score /= percent;
                return Math.max(0, (1 - Math.sqrt(score)) * 100);
            }

            function getVal(r) {
                switch (sortAttr) {
                    case 'age': return r.age;
                    case 'height': return r.height;
                    case 'weight': return r.weight;
                    case 'bust': return Array.isArray(r.three_sizes) ? r.three_sizes[0] : null;
                    case 'waist': return Array.isArray(r.three_sizes) ? r.three_sizes[1] : null;
                    case 'hip': return Array.isArray(r.three_sizes) ? r.three_sizes[2] : null;
                    case 'bmi': return (r.height && r.weight) ? r.weight / ((r.height / 100) ** 2) : null;
                    case 'similarity': return calculateSimilarity(similarityTargetRole, r);
                    default: return null;
                }
            }

            function updateCards() {
                container.innerHTML = '';
                let list = allRoles.filter(r => {
                    const pm = selected.has('ALL') || selected.has(r.production);
                    const am = !activeFilter || (r.type !== 'äº‹åŠ¡äººå‘˜' && r.group !== 'éå¯è‚²æˆå¶åƒ');
                    if (!pm || !am) return false;
                    if (sortAttr) { const v = getVal(r); return v != null; }
                    return true;
                });
                if (sortAttr) {
                    list.sort((a, b) => {
                        const va = getVal(a), vb = getVal(b);
                        if (sortAttr === 'similarity') {
                            return vb - va;
                        }
                        if (va === vb) {
                            if (a.age === b.age)
                            // age ç›¸åŒï¼ŒæŒ‰ birthdayï¼ˆMMDDï¼‰å€’åº
                            {
                                const ba = parseInt(a.birthday, 10) || 0;
                                const bb = parseInt(b.birthday, 10) || 0;
                                if (sortAttr === "age")
                                    return bb - ba;
                                return ba - bb;

                            }
                            return b.age - a.age;
                        }
                        return va - vb;
                    });
                } else {
                    list.sort((a, b) => {
                        const isBirthdayA = (a.birthday === todayStr);
                        const isBirthdayB = (b.birthday === todayStr);
                        return (isBirthdayB ? 1 : 0) - (isBirthdayA ? 1 : 0);
                    });
                }
                list.forEach(role => {
                    const card = document.createElement('div'); card.className = 'card';
                    const main = ['THE IDOLM@STER', 'CINDERELLA GIRLS', 'MILLION LIVE!', 'SideM', 'SHINY COLORS', 'Gakuen'];
                    const clr = main.includes(role.production) ? colorMap[role.production] : colorMap['Others'];
                    card.style.boxShadow = `inset 0 0 10px ${clr}`; card.style.border = `1px solid ${clr}`;
                    if (role.img) { const img = document.createElement('img'); img.src = role.img; card.appendChild(img); } else { const ph = document.createElement('div'); ph.className = 'img-placeholder'; card.appendChild(ph); }
                    const nm = document.createElement('div'); nm.className = 'name';
                    let lbl = role.name;
                    if (role.birthday === todayStr && !sortAttr) {
                        lbl = 'ğŸ‰ ' + lbl + ' ğŸ‚';
                    }
                    if (sortAttr) {
                        const v = getVal(role);
                        if (sortAttr === 'similarity') {
                            lbl += ` (${v.toFixed(2)}%)`;
                        } else {
                            lbl += sortAttr === 'age' ? ` (${v})` : (['height', 'weight', 'bust', 'waist', 'hip'].includes(sortAttr) ? ` (${v.toFixed(1)})` : ` (${v.toFixed(2)})`);
                        }
                    }
                    nm.textContent = lbl; card.appendChild(nm);
                    card.onclick = () => showDetail(role);
                    container.appendChild(card);
                });
            }

            function showDetail(role) {
                const dlg = document.querySelector('#modal .dialog'); dlg.style.border = ''; dlg.style.boxShadow = '';
                if (role.image_color) { dlg.style.boxShadow = `inset 0 0 12px ${role.image_color}`; dlg.style.border = `1px solid ${role.image_color}`; }
                detail.innerHTML = ''; const textDiv = document.createElement('div'); textDiv.className = 'text';
                const h2 = document.createElement('h2'); h2.textContent = role.name; textDiv.appendChild(h2);
                const detailFields = [['å£°ä¼˜', 'cv'], ['ç”Ÿæ—¥', 'birthday'], ['è¡€å‹', 'blood_type'], ['å‡ºèº«', 'hometown'], ['æƒ¯ç”¨æ‰‹', 'handedness'], ['æ‰€å±ç»„åˆ', 'group'], ['é¦–æ¬¡ç™»åœº', 'debut_date'], ['ä»‹ç»', 'bio']];
                detailFields.forEach(([label, key]) => { let val = role[key]; if (val == null) return; if (key === 'birthday' && typeof val === 'string' && val.length === 4) { const m = parseInt(val.slice(0, 2)); const d = parseInt(val.slice(2)); val = `${m}æœˆ${d}æ—¥`; } if (key === 'group' && val === 'éå¯è‚²æˆå¶åƒ') { return; } if (val == null) return; const div = document.createElement('div'); div.className = 'info'; div.innerHTML = `<strong>${label}:</strong>${val}`; textDiv.appendChild(div); });
                if (role.img) { const imgEl = document.createElement('img'); imgEl.src = role.img; detail.append(textDiv, imgEl); } else detail.append(textDiv);
                modal.style.display = 'flex';

                if (!role.age && !role.height && !role.weight && !role.three_sizes) { return; }
                const radarContainer = document.createElement('div'); radarContainer.id = 'radarChart'; radarContainer.style.width = '100%'; radarContainer.style.height = '260px'; textDiv.appendChild(radarContainer);

                radarContainer.onclick = (e) => {
                    // é˜»æ­¢äº‹ä»¶å†’æ³¡é˜²æ­¢å…³é—­å¼¹çª—ï¼ˆè™½ç„¶ä¸‹é¢æˆ‘ä»¬æ‰‹åŠ¨å…³äº†ï¼Œä½†ä¹ æƒ¯ä¸Šæœ€å¥½é˜»æ­¢ä¸€ä¸‹ï¼‰
                    e.stopPropagation();

                    // 1. è®¾ç½®åŸºå‡†è§’è‰²
                    similarityTargetRole = role;

                    // 2. æ£€æŸ¥å¹¶æ·»åŠ â€œç›¸ä¼¼åº¦â€é€‰é¡¹
                    let simOpt = sortSelect.querySelector('option[value="similarity"]');
                    if (!simOpt) {
                        simOpt = document.createElement('option');
                        simOpt.value = 'similarity';
                        simOpt.textContent = 'èº«æç›¸ä¼¼åº¦';
                        sortSelect.appendChild(simOpt);
                    }

                    // 3. é€‰ä¸­è¯¥é€‰é¡¹å¹¶æ›´æ–°æ’åºå±æ€§
                    sortSelect.value = 'similarity';
                    sortAttr = 'similarity';

                    // 4. å…³é—­å¼¹çª—
                    modal.style.display = 'none';

                    // 5. åˆ·æ–°å¡ç‰‡åˆ—è¡¨
                    updateCards();
                };

                const radarChart = echarts.init(radarContainer);
                const dims = [
                    { name: 'å¹´é¾„', value: role.age },
                    { name: 'èº«é«˜', value: role.height },
                    { name: 'ä½“é‡', value: role.weight },
                    { name: 'èƒ¸å›´', value: Array.isArray(role.three_sizes) ? role.three_sizes[0] : null },
                    { name: 'è…°å›´', value: Array.isArray(role.three_sizes) ? role.three_sizes[1] : null },
                    { name: 'è‡€å›´', value: Array.isArray(role.three_sizes) ? role.three_sizes[2] : null },
                ].filter(d => d.value != null);
                const main = ['THE IDOLM@STER', 'CINDERELLA GIRLS', 'MILLION LIVE!', 'SideM', 'SHINY COLORS', 'Gakuen'];
                const clr = main.includes(role.production) ? colorMap[role.production] : colorMap['Others'];
                const minVals = { 'å¹´é¾„': 9, 'èº«é«˜': 127, 'ä½“é‡': 28, 'èƒ¸å›´': 60, 'è…°å›´': 47, 'è‡€å›´': 65 };
                const maxVals = { 'å¹´é¾„': 28, 'èº«é«˜': 175, 'ä½“é‡': 60, 'èƒ¸å›´': 95, 'è…°å›´': 65, 'è‡€å›´': 92 };
                const imgColor = role.image_color ? role.image_color : clr;
                const option = {
                    textStyle: { fontFamily: 'font-title', fontSize: 14 },
                    tooltip: {
                        formatter: function (params) {
                            const seriesName = role.name;
                            const dataValue = params.value;
                            var dotHtml = `<span style="display:inline-block;margin:0 10px 2px 3px;border-radius:4px;width:4px;height:4px;background-color:${imgColor}"></span>`
                            let tooltipContent = `<div>${seriesName}</div>`;

                            dims.forEach((dim, index) => {
                                let unit = '';
                                if (dim.name === 'ä½“é‡') unit = '(kg)';
                                if (dim.name === 'èº«é«˜') unit = '(cm)';

                                tooltipContent += `
                    <div style="display: table-row;">
                        <div style="display: table-cell; text-align: left; padding-right: 20px;padding-top: 4px;">
                        ${dotHtml}${dim.name}${unit}
                        </div>
                        <div style="display: table-cell; text-align: right; font-weight: bold;padding-top: 4px;">
                            ${dataValue[index]}
                        </div>
                    </div>
                `;
                            });
                            tooltipContent += '</div>';
                            return tooltipContent;
                        }
                    },
                    radar: {
                        shape: 'polygon', splitNumber: 5, center: ['50%', '50%'],
                        indicator: dims.map(d => ({ name: `${d.name}(${d.value}${d.name === 'å¹´é¾„' ? '' : d.name === 'ä½“é‡' ? 'kg' : 'cm'})`, min: minVals[d.name], max: maxVals[d.name] })),
                        axisName: { color: '#000' },
                        axisLine: {
                            lineStyle: {
                                color: `${clr}80`,
                                width: 1,
                                type: 'solid'
                            }
                        },
                        splitLine: {
                            lineStyle: {
                                color: `${clr}80`,
                                width: 1,
                            }
                        },
                        splitArea: {
                            show: true,
                            areaStyle: {
                                color: ['#0000', `${clr}20`],
                            }
                        }
                    },
                    series: [{
                        type: 'radar',
                        data: [{
                            value: dims.map(d => d.value),
                            name: role.name,
                            areaStyle: { color: imgColor, opacity: 0.3 },
                            itemStyle: { color: imgColor },
                            lineStyle: { color: imgColor }
                        }]
                    }]
                };
                radarChart.setOption(option);
            }

            updateFilters(); updateCards();
            closeBtn.onclick = () => modal.style.display = 'none';
            modal.onclick = e => { if (e.target === modal) modal.style.display = 'none'; };
        });

        // ã“ã‚Œã‹ã‚‰ã‚‚ã€ã‚¢ã‚¤ãƒ‰ãƒ«!!!!!!
        const textFrontEl = document.getElementById('typing-front')
        const textInternalMarkEl = document.getElementById('typing-intermark')
        const textInternalEl = document.getElementById('typing-internal')
        const textRearEl = document.getElementById('typing-rear')
        const textMarkEl = document.getElementById('typing-mark')

        const exEl = Array
            .from({ length: 6 }, (_, i) => document.getElementById(`ex-mark${i + 1}`))
            .filter(Boolean);

        const text = 'ã“ã‚Œã‹ã‚‰ã‚‚ã€ã‚¢ã‚¤ãƒ‰ãƒ«';

        let time = 3000;

        for (let i = 1; i <= 16; ++i) {
            let interval = 375 - Math.random() * 200;

            if (i < 6) {
                setTimeout(function () {
                    textFrontEl.innerHTML = text.slice(0, i);
                },
                    time);
            }
            else if (i === 6) {
                setTimeout(function () {
                    textInternalMarkEl.innerHTML = text.slice(5, i);
                },
                    time);
            }
            else if (i < 10) {
                setTimeout(function () {
                    textInternalEl.innerHTML = text.slice(6, i);
                },
                    time);
            }
            else if (i === 10) {
                setTimeout(function () {
                    textRearEl.innerHTML = text.slice(9, i);
                    textMarkEl.style.marginLeft = '14px';
                },
                    time);
            }
            else if (i < 16) {
                setTimeout(function () {
                    exEl[i - 11].innerHTML = 'ï¼';
                },
                    time);
            }
            else {
                setTimeout(function () {
                    exEl[i - 11].innerHTML = 'ï¼';
                    textMarkEl.style.animation = 'typing-blink .7s 6';
                    textMarkEl.style.borderColor = 'transparent';
                },
                    time);
            }
            time += interval;
        }
    </script>
    <script src="js/gsap.min.js"></script>
    <script src="js/loading.js"></script>
</body>

</html>