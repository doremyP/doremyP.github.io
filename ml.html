<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>765 MILLION ALLSTARS</title>
    <link rel="icon" type="image/svg+xml" href="assets/favicon.svg">
    <link rel="stylesheet" href="./css/bg.css" />
    <link rel="stylesheet" href="./css/page2.css" />
    <style>
        h1 #title {
            color: #ffc30b;
            text-shadow: #ffc30b 0 0 15px;
        }

        h1 #title::after {
            background: linear-gradient(90deg, transparent, #ffc30b, transparent);
        }
    </style>
</head>

<body>
    <img src="assets/img/ml10thanni.webp" alt="" id="bg" />
    <h1> <button id="title">765 MILLION ALLSTARS</button></h1>
    <div id="charts">
        <!-- 雷达图 -->
        <div id="radarChart" class="chart"></div>
        <!-- 年龄、身高、体重 -->
        <div id="barAge" class="chart"></div>
        <div id="barHeight" class="chart"></div>
        <div id="barWeight" class="chart"></div>
        <!-- 胸围、腰围、臀围、BMI -->
        <div id="barBust" class="chart"></div>
        <div id="barWaist" class="chart"></div>
        <div id="barHip" class="chart"></div>
        <div id="barBMI" class="chart"></div>
    </div>
    <div class="legend">
        <span class="legend-item"><span class="legend-color" style="background:#FF2384"></span>Princess</span>
        <span class="legend-item"><span class="legend-color" style="background:#005EFF"></span>Fairy</span>
        <span class="legend-item"><span class="legend-color" style="background:#FFBB01"></span>Angel</span>
    </div>
    <script src="js/title.js"></script>
    <script src="js/echarts.min.js"></script>
    <script>
        fetch('data/c@st.min.json').then(res => res.json()).then(data => {
            const all = data.flatMap(p => p.staff.map(m => ({ ...m, production: p.production })));
            const validAll = all.filter(m => m.type !== '事务人员' && m.group !== '非可育成偶像');
            // ML staff: THE IDOLM@STER and MILLION LIVE!
            const mlStaff = validAll.filter(m => ['THE IDOLM@STER', 'MILLION LIVE!'].includes(m.production));
            const mean = arr => arr.length ? arr.reduce((a, b) => a + b, 0) / arr.length : 0;
            const avg = {
                age: mean(mlStaff.map(m => m.age).filter(v => v != null)),
                height: mean(mlStaff.map(m => m.height).filter(v => v != null)),
                weight: mean(mlStaff.map(m => m.weight).filter(v => v != null)),
                bust: mean(mlStaff.map(m => Array.isArray(m.three_sizes) ? m.three_sizes[0] : null).filter(v => v != null)),
                waist: mean(mlStaff.map(m => Array.isArray(m.three_sizes) ? m.three_sizes[1] : null).filter(v => v != null)),
                hip: mean(mlStaff.map(m => Array.isArray(m.three_sizes) ? m.three_sizes[2] : null).filter(v => v != null)),
            };
            // Radar chart
            const radar = echarts.init(document.getElementById('radarChart'));
            radar.setOption({
                title: { text: '平均属性', left: 'center', top: 15 },
                textStyle: {
                    fontFamily: 'font-title', fontSize: 14
                },
                tooltip: {},
                radar: {
                    shape: 'polygon', splitNumber: 5, center: ['50%', '55%'],
                    indicator: [
                        { name: '年龄', min: 15, max: 17.5 },
                        { name: '身高(cm)', min: 155, max: 160 },
                        { name: '体重(kg)', min: 40, max: 48.5 },
                        { name: '胸围(cm)', min: 79, max: 82 },
                        { name: '腰围(cm)', min: 53, max: 57 },
                        { name: '臀围(cm)', min: 78, max: 83 }
                    ], axisName: { color: '#333' }
                },
                series: [{
                    name: 'ML', type: 'radar', data: [{
                        value: [
                            +avg.age.toFixed(2), +avg.height.toFixed(2), +avg.weight.toFixed(2),
                            +avg.bust.toFixed(2), +avg.waist.toFixed(2), +avg.hip.toFixed(2)
                        ], name: '765 MILLION ALLSTARS', itemStyle: { color: '#ffc30b' }, areaStyle: { color: '#ffc30b', opacity: 0.3 },
                        label: { show: true, formatter: ({ value }) => value.toFixed(2), fontWeight: 'bold' }
                    }]
                }]
            });
            // Bar by type
            const types = ['Princess', 'Fairy', 'Angel'];
            const colors = { Princess: '#FF2384', Fairy: '#005EFF', Angel: '#FFBB01' };
            const typeData = types.map(t => {
                const arr = mlStaff.filter(m => m.type === t);
                return {
                    age: mean(arr.map(m => m.age).filter(v => v != null)),
                    height: mean(arr.map(m => m.height).filter(v => v != null)),
                    weight: mean(arr.map(m => m.weight).filter(v => v != null)),
                    bust: mean(arr.map(m => Array.isArray(m.three_sizes) ? m.three_sizes[0] : null).filter(v => v != null)),
                    waist: mean(arr.map(m => Array.isArray(m.three_sizes) ? m.three_sizes[1] : null).filter(v => v != null)),
                    hip: mean(arr.map(m => Array.isArray(m.three_sizes) ? m.three_sizes[2] : null).filter(v => v != null)),
                    bmi: mean(arr.map(m => m.height && m.weight ? m.weight / ((m.height / 100) ** 2) : null).filter(v => v != null))
                };
            });
            const metrics = [
                { id: 'barAge', key: 'age', title: '平均年龄', min: 15 },
                { id: 'barHeight', key: 'height', title: '平均身高(cm)', min: 150 },
                { id: 'barWeight', key: 'weight', title: '平均体重(kg)', min: 40 },
                { id: 'barBust', key: 'bust', title: '平均胸围(cm)', min: 75 },
                { id: 'barWaist', key: 'waist', title: '平均腰围(cm)', min: 50 },
                { id: 'barHip', key: 'hip', title: '平均臀围(cm)', min: 75 },
                { id: 'barBMI', key: 'bmi', title: '平均BMI', min: 15 }
            ];
            metrics.forEach(met => {
                const chart = echarts.init(document.getElementById(met.id));
                chart.setOption({
                    title: { text: met.title, left: 'center', top: 20 },
                    textStyle: { fontFamily: 'font-title' },
                    grid: { top: 80, containLabel: true },
                    tooltip: { trigger: 'item', formatter: params => `${params.seriesName}<br />${params.marker}${params.name} ${params.value.toFixed(2)}` },
                    xAxis: { show: false, data: types }, yAxis: { type: 'value', min: met.min },
                    series: [{
                        name: met.title, type: 'bar', barWidth: '50%',
                        data: types.map((t, i) => ({ value: typeData[i][met.key], itemStyle: { color: colors[t] } })),
                        label: { show: true, position: 'top', fontWeight: 'bold', formatter: params => params.value.toFixed(2) }
                    }]
                });
            });
        });
    </script>
</body>

</html>